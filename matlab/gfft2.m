function gfield = gfft2(wfield, nx, ny)%GFFT2   Wave-to-grid Fourier transform. %    GFIELD = GFFT2(WFIELD, nx, ny) transforms the field WFIELD in%    wavenumber space to the field GFIELD on a grid of size [nx, ny].%%    GFFT2 is the inverse of WFFT2.    [nkx, nky] = size(wfield);    % y-indices of nonzero entries in full wavenumber field of size [nx,ny]  kys        = [1:ceil(nky/2), ny-floor(nky/2):ny-1];  ikys       = [1, ny-1:-1:ny-floor(nky/2), ceil(nky/2): -1 :2];  % assemble full wavenumber field (including zero pads)  wfieldl                       = complex(zeros(max(nx - 1, 1), ny - 1));  wfieldl(1:nkx, kys)           = wfield;  wfieldl(nx-1:-1:nx-nkx+1, ikys) = conj(wfield(2:nkx, :));     % transform from wavenumber space to grid space  gfield = zeros(nx, ny);  gfield(1:max(nx-1, 1), 1:ny-1)   = real(ifft2(wfieldl));  gfield(end, 1:end-1)     = gfield(1, 1:end-1);  gfield(:, end)           = gfield(:, 1);