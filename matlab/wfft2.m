function wfield = wfft2(gfield, nkx, nky)%WFFT2   Grid-to-wave Fourier transform %    WFIELD = WFFT2(GFIELD, nkx, nky) transforms the field GFIELD in%    grid space to the field WFIELD in wavenumber space. The field%    WFIELD in wavenumber space has size [nkx, nky], which corresponds%    to retaining the x-Fourier components -(nkx-1),..., (nkx-1) and%    the y-Fourier components -floor(nky/2),..., ceil(nky/2)-1. If%    the field GFIELD in grid space has size [nx, ny], the size%    [nkx, nky] of the field WFIELD in wavenumber space must satisfy%    nkx <= nx/2 and nky <= ny.%%    The inverse of WFFT2 is GFFT2.    [nx, ny] = size(gfield);  % transform from grid space to wavenumber space  wfieldl  = fft2(gfield(1:max(end-1,1), 1:end-1));  % wavenumber truncation and elimination of redundant coefficients  kys      = [1:ceil(nky/2), ny-floor(nky/2):ny-1];  wfield   = zeros(nkx, nky);    wfield   = wfieldl([1:nkx], kys);