function wC = wjacobian(wA, wB, kx, ky, nx, ny)%WJACOBIAN  Jacobian in wavenumber space%    WJ = WJACOBIAN(WA, WB, kx, ky, nx, ny) evaluates the Jacobian WJ%    of the fields WA and WB in wavenumber space using the spectral%    transform method. The vectors kx and ky are vectors of%    wavenumbers, and the scalars nx and ny give the size of the%    transform grid on which the products are evaluated.    if any(size(wB) ~= size(wA))    error('Input fields must be of equal size.')  end  [nkx, nky] = size(wA);    % assemble wavenumber matrices of same size as wavenumber fields  % and multiply by i  ikx        = i*repmat(kx(:), 1, nky);  iky        = i*repmat(ky(:)', nkx, 1);    % evaluate Jacobian  gC         = gfft2(ikx.*wA, nx, ny) .* gfft2(iky.*wB, nx, ny) ...             - gfft2(ikx.*wB, nx, ny) .* gfft2(iky.*wA, nx, ny);  wC         = wfft2(gC, nkx, nky);